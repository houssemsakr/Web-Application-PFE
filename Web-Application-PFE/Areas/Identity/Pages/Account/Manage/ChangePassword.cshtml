@page
@model ChangePasswordModel
@{
    ViewData["Title"] = "Change password";
    ViewData["ActivePage"] = ManageNavPages.ChangePassword;
    Layout = "~/Views/Home/_LayoutLogin.cshtml";
}

<style>
    .main-container {
        padding-left: 0;
        margin-left: 0;
    }

    .password-form-container {
        margin-left: -820px;
    }

    .button-row {
        display: flex;
        gap: 10px;
        margin-top: 11px;
       
    }

        .button-row .btn {
            flex: 1;
        }

    .settings-container {
        display: flex;
        gap: 90px;
        margin-right: 600px;
    }

    .photo-section {
        margin-bottom: 40px;
    }

    .photo-container {
        width: 130px;
        height: 100px;
        border: 2px dashed white;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        background-color: transparent;
    }

    .profile-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
    }

    .profile-icon {
        margin-right: -14px;
    }

    #profile-picture-input {
        display: none;
    }

    .add-photo-btn {
        position: absolute;
        right: -15px;
        bottom: -15px;
        width: 40px;
        height: 40px;
        background-color: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border: none;
        outline: none;
    }

        .add-photo-btn svg {
            width: 24px;
            height: 24px;
        }

    .language-section {
        margin-bottom: 40px;
    }

    .language-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: lightgray;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        width: 150px;
        height: 20px;
    }

    .checkbox {
        width: 15px;
        height: 15px;
        background-color: white;
    }

    .profile-line {
        border-top: 2px solid #000;
    }

</style>

<div style="width: 100%; margin-bottom: 20px;">
    <h3 style="color: white; margin-bottom: 10px; display: flex; align-items: center;">
        <span style="margin-right: 10px;"> < </span> Paramètres
    </h3>
    <hr style="border: 0; height: 1px; background-color: white; margin: 0;">
</div>

<partial name="_StatusMessage" for="StatusMessage" />
<form id="change-password-form" method="post" enctype="multipart/form-data">
<div class="settings-container">
    <div class="photo-section">
        <h5 style="color:white;font-weight:300">M&nbsp;o&nbsp;d&nbsp;i&nbsp;f&nbsp;i&nbsp;e&nbsp;r&nbsp;&nbsp; l&nbsp;a&nbsp;&nbsp; p&nbsp;h&nbsp;o&nbsp;t&nbsp;o</h5>
        <div class="photo-container">

            @if (!string.IsNullOrEmpty(Model.CurrentUser?.imagePath))
            {
                <img src="@Model.CurrentUser.imagePath" alt="Photo de profil" class="profile-image" id="profile-picture" />
            }
            else
            {
                <div class="profile-icon" id="profile-icon">
                    <i class="bi bi-person-fill">
                        <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
                    </i>
                </div>
            }

            <input type="file" id="profile-picture-input" name="ProfilePicture" accept="image/*" />
            <label for="profile-picture-input" class="add-photo-btn">
                  +  
            </label>
        </div>
    </div>

   
</div>

<div>
 
        <h5 style="color:white;font-weight:300">M&nbsp;o&nbsp;d&nbsp;i&nbsp;f&nbsp;i&nbsp;e&nbsp;r&nbsp;&nbsp; l&nbsp;e&nbsp;&nbsp; m&nbsp;o&nbsp;t &nbsp;&nbsp;d&nbsp;e &nbsp;&nbsp;p&nbsp;a&nbsp;s&nbsp;s&nbsp;e</h5>
        <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
        <div class="input-group">
            <div class="input-icon">
                <i class="fas fa-lock icon-inside"></i>
            </div>
            <input asp-for="Input.OldPassword" type="password" class="form-input" autocomplete="new-password"  placeholder="Mot de passe actuel" style="width:300px;  />
            <span asp-validation-for="Input.OldPassword" class="text-danger"></span>
        </div>
        <div class="input-group">
            <div class="input-icon">
                <i class="fas fa-lock icon-inside"></i>
            </div>
            <input asp-for="Input.NewPassword" type="password" class="form-input" autocomplete="new-password" placeholder="Nouveau Mot de passe" style="width:300px;  />
            <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
        </div>
        <div class="input-group">
            <div class="input-icon">
                <i class="fas fa-lock icon-inside"></i>
            </div>
            <input asp-for="Input.ConfirmPassword" type="password" class="form-input" autocomplete="new-password"  placeholder="Nouveau Mot de passe" style="width:300px; />
            <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
        </div>
        <div >
            <button type="button" onclick="window.location.href='/Home'" class="btn btn-lg btn-primary" style="width:150px;">Retour</button>
            <button type="submit" class="btn btn-lg btn-primary" style="width:310px;height:50px">Enregistrer les modifications</button>
        </div>
 
</div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById('profile-picture-input').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    var profilePicture = document.getElementById('profile-picture');
                    var profileIcon = document.getElementById('profile-icon');

                    if (!profilePicture) {
                        if (profileIcon) profileIcon.remove();

                        var img = document.createElement('img');
                        img.id = 'profile-picture';
                        img.className = 'profile-image';
                        img.alt = 'Photo de profil';
                        document.querySelector('.photo-container').prepend(img);
                        profilePicture = img;
                    }

                    profilePicture.src = e.target.result;
                }

                reader.readAsDataURL(e.target.files[0]);
            }
        });
    </script>
}